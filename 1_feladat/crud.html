<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Web-programozás-1 - CRUD</title>
    <link type="text/css" rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 class="header">Web-programozás-1 Elméleti Házi feladat</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="crud.html" class="active">Táblázat</a></li>
            <li><a href="html5.html">HTML5</a></li>
            <li><a href="chartjs.html">ChartJS</a></li>
            <li><a href="ajax.html">AJAX</a></li>
        </ul>
    </nav>
    <aside>
        <h1>Introduction</h1>
    </aside>
    <div class="content">
        <h1>Crud functionality</h1>
        <article>
			<form id="create_form">
				<label>
					Név: <input type="text" name="name" placeholder="Név" minlength="5" id="input_name" required>
				</label>
				<label>
					Magasság: <input type="number" name="height" placeholder="Magasság" id="input_height" min="0" required>
				</label>
				<label>
					Tömeg: <input type="number" name="weight" min="0" max="1000" placeholder="Tömeg" id="input_weight" required>
				</label>
				<button type="submit">Hozzáadás</button>
			</form>
			<form id="edit_form" class="d-none">
				<input type="hidden" name="id" id="input_index_update">
				<label>
					Név: <input type="text" name="name" placeholder="Név" minlength="5" id="input_name_update" required>
				</label>
				<label>
					Magasság: <input type="number" name="height" placeholder="Magasság" id="input_height_update" min="0" required>
				</label>
				<label>
					Tömeg: <input type="number" name="weight" placeholder="Tömeg" min="0" max="1000" id="input_weight_update" required>
				</label>
				<button type="submit">Szerkeszt</button>
				<button type="button" id="btn_edit_back">Mégsem</button>
			</form>
		</article>
		<article style="margin-top: 10px;">
			Kereső:
			<input type="text" id="crud_filter" placeholder="Keresés">
			Sorrend:
			<select id="crud_order_field">
				<option value="id">Hozzáadás ideje</option>
				<option value="name">Név</option>
				<option value="height">Magasság</option>
				<option value="weight">Tömeg</option>
			</select>
			<select id="crud_order">
				<option value="asc">Csökkenő</option>
				<option value="desc">Növekvő</option>
			</select>
        </article>
        <article id="crud_list"></article>
    </div>
    <footer>Készítők neptun kódja: NCCDTY, UXPEB6</footer>
	<script>
		data		= [];
		function crud_create(name, height, weight)
		{
			data[data.length]	=	{
				id: data.length + 1,
				name: name,
				height: height,
				weight: weight,
			};
			draw_table();
			
			return false;
		}

		function crud_update(index, name, height, weight)
		{
			data[index]	=	{
				id: data[index].id,
				name: name,
				height: height,
				weight: weight,
			};
			
			draw_table();
			
			return false;
		}

		function crud_delete(index)
		{
			delete data[index];
			draw_table();
			
			return false;
		}
		
		function escapeHtml(text) {
			return text
				.replace(/&/g, "&amp;")
				.replace(/</g, "&lt;")
				.replace(/>/g, "&gt;")
				.replace(/"/g, "&quot;")
				.replace(/'/g, "&#039;");
		}
		
		function draw_table()
		{
			let filter		= document.getElementById("crud_filter").value.toLowerCase();
		
			let orderField	= document.getElementById("crud_order_field").value;
			let order		= document.getElementById("crud_order").value;
		
			if(orderField == "name") {
				data.sort((a, b) => a[orderField].localeCompare(b[orderField]) * (order == "asc" ? -1 : 1));
			} else {
				data.sort((a, b) => (Number(a[orderField]) - Number(b[orderField])) * (order == "asc" ? -1 : 1));
			}
		
			str	= "<table>";
			str	+= "<thead><tr><th>#</th><th>Név</th><th>Magasság</th><th>Tömeg</th><th></th></tr></thead>";
			for(i = 0; i < data.length; i++) {
				if(typeof data[i] == "undefined") { // törölt sor
					continue;
				}
				if(!data[i].name.toLowerCase().includes(filter) && !data[i].height.toLowerCase().includes(filter) && !data[i].weight.toLowerCase().includes(filter)) {
					continue;
				}
				str	+= "<tr id=\"list_item_" + i + "\">";
				str	+= "<td>#" + (data[i].id) + "</td>";
				str	+= "<td class=\"col_name\">" + escapeHtml(data[i].name) + "</td>";
				str	+= "<td class=\"col_height\">" + escapeHtml(data[i].height) + "</td>";
				str	+= "<td class=\"col_weight\">" + escapeHtml(data[i].weight) + "</td>";
				str	+= "<td><a class=\"list_item_delete\" data-index=\"" + i + "\" href=\"#\">Törlés</a> | <a class=\"list_item_edit\" data-index=\"" + i + "\" href=\"#\">Szerkeszt</a></td>";
				str	+= "</tr>";
			}
			str += "</table>";
			document.getElementById("crud_list").innerHTML	= str;
			
			elements	= document.getElementsByClassName("list_item_delete");
			for (var i = 0; i < elements.length; i++) {
				elements[i].addEventListener("click", function(e){
					e.preventDefault();
					crud_delete(this.getAttribute("data-index"));
				});
			}	
			
			elements	= document.getElementsByClassName("list_item_edit");
			for (var i = 0; i < elements.length; i++) {
				elements[i].addEventListener("click", function(e){
					e.preventDefault();
					index	= this.getAttribute("data-index");
					
					document.getElementById("create_form").classList.add("d-none");
					document.getElementById("edit_form").classList.remove("d-none");
					
					document.getElementById("input_index_update").value = index;
					document.getElementById("input_name_update").value = data[index].name;
					document.getElementById("input_height_update").value = data[index].height;
					document.getElementById("input_weight_update").value = data[index].weight;
				});
			}	
		}
		
		document.getElementById("create_form").addEventListener("submit", function(e) {
			e.preventDefault();
			let name	= document.getElementById("input_name").value;
			let height	= document.getElementById("input_height").value;
			let weight	= document.getElementById("input_weight").value;
			
			crud_create(name, height, weight);
			this.reset();
			
		});
		
		document.getElementById("edit_form").addEventListener("submit", function(e) {
			e.preventDefault();
			let index		= document.getElementById("input_index_update").value;
			let name	= document.getElementById("input_name_update").value;
			let height	= document.getElementById("input_height_update").value;
			let weight	= document.getElementById("input_weight_update").value;
			
			document.getElementById("create_form").classList.remove("d-none");
			document.getElementById("edit_form").classList.add("d-none");
			
			crud_update(index, name, height, weight);
		});
		
		document.getElementById("btn_edit_back").addEventListener("click", function(e) {
			document.getElementById("create_form").classList.remove("d-none");
			document.getElementById("edit_form").classList.add("d-none");
		});
		
		document.getElementById("crud_filter").addEventListener("keyup", function(e) {
			draw_table();
		});
		
		document.getElementById("crud_order_field").addEventListener("change", function(e) {
			draw_table();
		});
		
		document.getElementById("crud_order").addEventListener("change", function(e) {
			draw_table();
		});
		
	</script>
	<style>
		#crud_list > table {
			border-collapse: collapse;
			margin:10px;
		}
		
		#crud_list > table td, #crud_list > table th {
			border:1px solid black;
			padding:10px;
		}
		
		.d-none {
			display:none;
		}
	</style>
</body>
</html>
